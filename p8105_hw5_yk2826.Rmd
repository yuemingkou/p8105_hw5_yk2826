---
title: "Homework 5"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(rvest)
knitr::opts_chunk$set(
  fig.width = 9,
  fig.asp = .8,
  out.width = "90%"
)
theme_set(theme_bw() + theme(legend.position = "bottom"))
```

## Problem 1

Create a tidy dataframe containing data from all participants:

First, start with a dataframe containing all file names and read in data:

```{r load_data, message = FALSE}
longitudinal_df = 
  tibble(file_names = list.files("./data/")) %>% 
  mutate(subject_data = map(str_c("./data/", file_names), read_csv))
```

Then, tidy the dataset:

```{r tidy_data}
longitudinal_tidy = 
  longitudinal_df %>% 
  unnest %>% 
  mutate(file_names = str_replace(file_names, ".csv", "")) %>% 
  separate(file_names, into = c("arm", "subject_ID"), sep = "_") %>% 
  mutate(arm = str_replace(arm, "con", "control"),
         arm = str_replace(arm, "exp", "experimental")) %>% 
  gather(key = week, value = observation, week_1:week_8) %>% 
  mutate(week = str_replace(week, "week_", ""),
         week = as.integer(week)) %>% 
  arrange(arm, subject_ID)
```

Look at the resulting dataset:

```{r check_result}
longitudinal_tidy
str(longitudinal_tidy)
```

Make a spaghetti plot showing observations on each subject over time, and comment on differences between groups:

```{r spaghetti_plot}
longitudinal_tidy %>% 
  mutate(ID = str_c(arm, "_", subject_ID)) %>% 
  ggplot(aes(x = week, y = observation, group = ID, color = arm)) + 
    geom_line() + 
    labs(
      title = "Observations on each subject over time",
      x = "Week",
      y = "Observation",
      caption = "Data from the longitudinal study"
    ) 
```

From the sphaghetti plot, the experimental group and control group had similar observations at baseline. However, the observations of subjects in experimental group are generally higher than observations of subjects in control group through 8 weeks. The difference between two groups increased over time since subjects assigned to the experimental arm had increasing observation values across weeks while subjects assigned to the control arm had relatively constant observation values.

## Problem 2

First, load and describe the row data:

```{r load_homicide, message = FALSE}
homicide_df = read_csv("./homicide-data.csv")
homicide_df
```

The Washington Post homicide dataset contains `r nrow(homicide_df)` observations, where each observation is a case of homicide.

There are 12 variables in this dataset:  

uid: homicide identifier;  
reported_date: the date on which the killing was reported;  
victim_last: the last name of the victim;  
victim_first: the first name of the victim;  
victim_race: the race of the victim;  
victim_age: the age of the victim;  
victim_sex: the sex of the victim;  
city, state, lat, lon:  the location of the killing;  
disposition: whether the case was closed and whether an arrest was made.
